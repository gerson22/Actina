<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Actina</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,600' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="/c/normalize.css">
    <link rel="stylesheet" href="/c/main.css">
    <link rel="stylesheet" href="/c/general.css">
    <link rel="stylesheet" href="/c/inscripcion.css">
    <script src="/lib/modernizr-2.6.2.min.js"></script>
</head>
<body>

<nav id="menu_top" class="navbar navbar-default navbar-fixed-top" role="navigation" >
    <div class="container">
        <a href="/index.php">
            <img class="icono_left" src="i/icon_home.png" />
        </a>
        <a href="/includes/logout.php">
            <img class="icono" src="i/icon_logout.png" />
        </a>
        <a href="/administracion.html">
            <img class="icono" src="i/icon_administracion.png" />
        </a>
    </div>
</nav>

<div class="container" id="container">
    <div class="container-fluid">
        <form id="form_inscripcion" class="form-horizontal" action="">
            <div class="col-md-12">
                <div id="foto_wrapper">
                    <img id="foto" src="i/foto_placeholder.png">
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label class="control-label" for="nombreVal">Nombre</label>
                    <input type="text" required class="form-control input-md" id="nombreVal" >
                </div>
                <div class="form-group">
                    <label class="control-label" for="pesoVal">Peso</label>
                    <input type="text" required class="form-control input-md" id="pesoVal" >
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label class="control-label" for="emailVal">Email</label>
                    <input type="text" required class="form-control input-md" id="emailVal" >
                </div>
                <div class="form-group">
                    <label class="control-label" for="alturaVal">Altura</label>
                    <input type="text" required class="form-control input-md" id="alturaVal" >
                </div>
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label class="control-label" for="subscripcionVal">Tipo de subscripción</label>
                    <select required class="form-control input-md" id="subscripcionVal">
                        <option value="1">Mensual</option>
                        <option value="2">Semanal</option>
                        <option value="3">Diaria / Eventual</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="control-label" for="tallaVal">Talla</label>
                    <input type="text" required class="form-control input-md" id="tallaVal" >
                </div>
            </div>

            <button type="button" onclick="inscribir()">Inscribir</button>
        </form>
    </div>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="/lib/jquery.validate.min.js"></script>
<script>
    var connection;
    var lector_disponible;

    conectar();

    function conectar()
    {
        connection = new WebSocket('ws://localhost:8080');

        connection.onopen = function ()
        {
            console.log("Conexión abierta");
            checarLector();
        };

        connection.onerror = function (error)
        {
            console.log("Error: " + error);
        };

        connection.onmessage = function (e)
        {
            console.log("Mensaje: " + e.data);
            switch (e.data)
            {
                case "lectorStandby": $("#status").html("Disponible"); break;
                case "lectorOff": $("#status").html("No disponible"); break;
                default: break;
            }
        };
    }

    function checarLector()
    {
        if(connection)
        {
            connection.send("hola");
        }
    }

    function inscribir()
    {
        if($("#form_inscripcion").valid())
        {
            var nombre = $("#nombreVal").val();
            var password = $("#passVal").val();
            var email = $("#emailVal").val();
            var peso = $("#pesoVal").val();
            var altura = $("#alturaVal").val();
            var talla = $("#tallaVal").val();
            var tipoSub = $("#subscripcionVal").val();

            $.ajax({
                type: "POST",
                url: "",
                headers: { "Authorization": "Basic " + btoa(sessionStorage.getItem("email") + ":" + sessionStorage.getItem("password")) },
                crossDomain: true,
                data: "nombre=" + nombre + "&password=" + password + "&email=" + email + "&peso=" + peso
                    + "&altura=" + altura + "&talla=" + talla + "&tipoSub=" + tipoSub
            }).done(function()
            {
                alert("Cliente registrado");
            }).fail(function()
            {
                alert("nope.");
            });
        }
    }

</script>
</body>